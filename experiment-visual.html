<!DOCTYPE html>
<html>
  <head>
		<title>P300 Experiment</title>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-text.js"></script>
    <script src="jspsych/plugins/jspsych-survey-text.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <script src="jspsych/plugins/jspsych-single-stim.js"></script>
	</head>
	<body></body>
  <script>

    var timeline = [];

    var welcome = {
      type: "text",
      text: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);

    var instructions = {
      type: "text",
      text: "<p>In this experiment, either a red or blue circle with a black plus sign in the center will appear" +
      " on the screen.</p><p>Your task is to count how many of the circles are the color red," +
      "<p>Press any key to begin" +
      "<div style='float: left;'><img src='Blue.png'></img>" +
      "<div style='float: right;'><img src='Red.png'></img>",
    timing_post_trial: 2000
    };
    timeline.push(instructions);



    var test_stimuli = [
      { stimulus: "Blue.png", data: {test_part: 'test'}},
      { stimulus: "Red.png", data: {test_part: 'test'}}
    ];

    var fixation = {
      type: 'single-stim',
      stimulus: "Fixation.png",
      timing_response: 133,
      data: {test_part: 'fixation'}
    }

    var test = {
      type: "single-stim",
      stimulus: jsPsych.timelineVariable( 'stimulus'),
      data: jsPsych.timelineVariable('data'),
      timing_response: 83,
      on_finish: function(data){
        data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      }
    }

    var test_procedure = {
      timeline: [fixation, test],
      timeline_variables: test_stimuli,
      randomize_order: true,
      repetitions: 5
    };

    timeline.push(test_procedure);


    var survey_trial = {
      type: 'survey-text',
      questions: ["How many circles were red?"],
      rows: [1],
      columns: [1]
    };

    timeline.push(survey_trial);

    var debrief_block = {
      type: "text",
      text: function() {

      var trials = jsPsych.data.get().filter({test_part: 'test'});

      return"<p>Press any key to complete the experiment. Thank you!</p>";
      }
    }

    timeline.push(debrief_block);

    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
      }
    });
  </script>
</html>
